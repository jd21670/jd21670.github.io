<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <title>Cholera Outbreak of 1854</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <link rel="stylesheet" href="style.css">
	</head>
	<body>
		<div class = "header">Cholera Outbreak of 1854</div>
        <div class="grid">
            <div class="g s1">
                <svg id = "map" width="600" height="600">
                    <g></g>
                </svg>
            </div>
            <div class="g s2"></div>
            <div class="g s3"></div>
            <div class="g s4">
                <svg id = "daybar" width="600" height="300">
                    <g></g>
                </svg>
            </div>
        </div>

        <script>
            
            d3.csv("data/deathdays.csv", ({date, deaths}) => ({date: new Date(date+"-1854"), deaths: +deaths})).then(function(death_days) {
                    d3.csv("data/deaths_age_sex.csv").then(function(death_details) {
                        var i = 0; //detail index
                        var j = 0; //days index
                        var k = 0; //counter
                        var det_len = death_details.length;
                        var day_len = death_days.length;
                        console.log(death_days);

                        while (j < day_len) {
                            //death_details[i].new = "test";
                            //console.log(death_details[i].gender);
                            deaths = death_days[j].deaths;

                            for (k = 0; k < deaths; k++) {
                                death_details[i].date = death_days[j].date;
                                death_details[i].daynum = j;
                                //console.log(death_details[i]);
                                i++;
                            }
                            j++;
                        }

                        death_days.deaths = parseInt(death_days.deaths);
                        draw_daybar(death_days);
                    });
                });

            function draw_daybar (death_days) {
                var bar_x = 600,
                    bar_y = 300,
                    padding = 25;

                bar_max = d3.max(death_days, function (d) {return d.deaths;});
                date_min = d3.min(death_days, function (d) {return d.date;});
                date_max = d3.max(death_days, function (d) {return d.date;});
                //date_first = death_days[0].date;
                //date_last
                //console.log("max = ", bar_max);
                bar_count = death_days.length;
                //console.log("count = ", bar_count);
                console.log(date_min, date_max);




                // append the svg object to the body of the page
                var svg = d3.select("#daybar g")
                    .append("svg")
                    .attr("width", bar_x + 2*padding)
                    .attr("height", bar_y + 2*padding)
                    .append("g");
                    //.attr("transform", 'translate(${margin.left},${margin.top})');

                var x_scale = d3.scaleTime()
                                    .domain([date_min, date_max])
                                    .range([0, bar_x]);

                var y_scale = d3.scale.linear()
                                      .range([bar_y, 0])
                                      .domain([0,bar_max]);
                // X axis
//                var x = d3.scaleBand()
 //                       .range([ 0, width ])
   //                     .domain(death_days.map(function(d) { return d.date; }))
     //                   .padding(0.2);
                svg.append("g")
                    .attr("transform", "translate(0," + bar_x + ")")
                    .call(d3.axisBottom(x_scale))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");
                

                




            }


        </script>
	</body>
</html>